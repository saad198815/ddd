<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ®Ø²ÙŠÙ† ÙÙˆØ§ØªÙŠØ±</title>
</head>
<body dir="rtl">
  <h2>Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©</h2>
  <input type="text" id="year" placeholder="Ø§Ù„Ø³Ù†Ø© (Ù…Ø«Ù„Ø§Ù‹ 2025)">
  <input type="text" id="month" placeholder="Ø§Ù„Ø´Ù‡Ø± (Ù…Ø«Ù„Ø§Ù‹ 07)">
  <input type="text" id="day" placeholder="Ø§Ù„ÙŠÙˆÙ… (Ù…Ø«Ù„Ø§Ù‹ 08)">
  <input type="text" id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù…Ø«Ù„Ø§Ù‹ invoice1.txt)">
  <br><br>
  <textarea id="content" rows="5" cols="50" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©"></textarea><br><br>
  <button onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸</button>
  <hr>
  <h2>Ø¹Ø±Ø¶ ÙÙˆØ§ØªÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</h2>
  <button onclick="getInvoices()">ğŸ“‚ Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</button>
  <div id="results"></div>

  <script>
    let db;

    const request = indexedDB.open("InvoicesDB", 1);

    request.onupgradeneeded = function (e) {
      db = e.target.result;
      const store = db.createObjectStore("invoices", { keyPath: "id", autoIncrement: true });
      store.createIndex("dateIndex", ["year", "month", "day"], { unique: false });
    };

    request.onsuccess = function (e) {
      db = e.target.result;
      console.log("âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©");
    };

    function saveInvoice() {
      if (!db) return alert("Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ØªØ¬Ù‡Ø² Ø¨Ø¹Ø¯ØŒ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ù‹Ø§");

      const year = document.getElementById("year").value;
      const month = document.getElementById("month").value;
      const day = document.getElementById("day").value;
      const name = document.getElementById("name").value;
      const content = document.getElementById("content").value;

      const tx = db.transaction("invoices", "readwrite");
      const store = tx.objectStore("invoices");

      store.add({ year, month, day, name, content });

      tx.oncomplete = () => alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©");
      tx.onerror = () => alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ÙØ¸");
    }

    function getInvoices() {
      if (!db) return alert("Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ØªØ¬Ù‡Ø² Ø¨Ø¹Ø¯");

      const year = document.getElementById("year").value;
      const month = document.getElementById("month").value;
      const day = document.getElementById("day").value;

      const tx = db.transaction("invoices", "readonly");
      const store = tx.objectStore("invoices");
      const index = store.index("dateIndex");
      const request = index.getAll([year, month, day]);

      request.onsuccess = () => {
        const invoices = request.result;
        const container = document.getElementById("results");
        container.innerHTML = "";

        if (invoices.length === 0) {
          container.innerText = "ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…";
          return;
        }

        invoices.forEach(i => {
          const blob = new Blob([i.content], { type: "text/plain" });
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = i.name;
          a.textContent = "â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ " + i.name;
          a.style.display = "block";
          container.appendChild(a);
        });
      };
    }
  </script>
</body>
</html>
